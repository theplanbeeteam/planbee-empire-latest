{"version":3,"sources":["webpack:///./source/scripts/Layout.js","webpack:///./source/scripts/helpers/Quantity.js","webpack:///./source/scripts/Forms.js","webpack:///./source/scripts/components/RichText.js","webpack:///./source/scripts/components/Youtube.js","webpack:///./source/scripts/components/Vimeo.js","webpack:///./source/scripts/components/Video.js","webpack:///./source/scripts/components/ProductClickToZoom.js","webpack:///./source/scripts/components/ProductGallery.js","webpack:///./source/scripts/components/ProductDetails.js","webpack:///./source/scripts/components/MessageBanner.js","webpack:///./source/scripts/helpers/Images.js","webpack:///./source/scripts/components/AddToCartFlyout.js"],"names":["eventHandlers","previousBreakpoint","getBreakpoints","window","getComputedStyle","document","documentElement","getPropertyValue","replace","split","getBreakpoint","$","on","event","currentBreakpoint","forEach","eventHandler","previous","current","isLessThanBreakpoint","breakpoint","inclusive","breakpoints","comparison","indexOf","isGreaterThanBreakpoint","isBreakpoint","some","onBreakpointChange","push","offBreakpointChange","index","splice","Quantity","el","$el","$inputParent","find","$input","$selectParent","$select","_watchSelect","bind","_watchInput","off","baseValue","parseInt","currentTarget","value","isNaN","_validateValue","val","trigger","removeClass","addClass","focus","removeAttr","select","attr","Forms","selector","filledClass","fieldSelector","quantityItems","$quantityWrapper","_toggleFilled","_checkFilled","length","each","i","quantityItem","unload","hasClass","target","$target","isFilled","is","toggleClass","e","RichText","_initExternalLinks","groupedContent","GroupedContent","get","layout","intelliparse","fitvids","anchors","filter","href","location","hostname","api","apiLoadedCallbacks","apiLoaded","onYouTubeIframeAPIReady","apiLoadedCallback","Youtube","videoUrl","loop","regex","id","match","onApiLoaded","_onApiLoaded","isReady","onReady","_onReady","onReadyCallback","onStateChange","_onStateChange","onPlayCallback","$script","Promise","resolve","player","playVideo","pauseVideo","mute","destroy","playerVars","modestbranding","showinfo","controls","rel","playlist","YT","Player","videoId","events","state","data","PlayerState","BUFFERING","VimeoPlayer","urlParts","onProgress","_onProgress","onProgressCallback","play","pause","setVolume","catch","Vimeo","ready","then","Video","options","platform","getAttribute","trim","playButton","querySelector","videoEl","onPlayClick","_onPlayClick","onPauseClick","_onPauseClick","autoplay","_autoplay","video","videoData","childNodes","addEventListener","classList","add","setTimeout","remove","removeEventListener","ProductClickToZoom","settings","slides","originalThumbnails","startIndex","selectGalleryIndex","photoswipeDialog","thumbContainer","thumbScroller","thumbScrollerButtons","querySelectorAll","closeButton","selectedSlide","innerHTML","thumbnails","selectedIndex","thumb","thumbIndex","dataset","mediaType","newThumb","cloneNode","appendChild","rimg","watch","selectedThumb","EventHandler","photoswipeSlides","slide","src","zoom","msrc","h","imageHeight","w","imageWidth","bottomBarHeight","photoswipeOptions","barsSize","top","bottom","fullscreenEl","zoomEl","shareEl","counterEl","arrowEl","preloaderEl","closeOnScroll","showHideOpacity","history","clickToCloseNonZoomable","timeToIdle","timeToIdleOutside","click_to_zoom","getThumbBoundsFn","pageYScroll","pageYOffset","scrollTop","bounds","getBoundingClientRect","x","left","y","width","photoswipe","PhotoSwipe","photoswipeUi","register","close","goTo","_handleScrollButtonVisibility","_onScrollButtonClick","mouseUsed","closeOnVerticalDrag","listen","getCurrentIndex","gallerySelected","slideIndex","_adjustMobileThumbPosition","removeTrapFocus","unregisterAll","closeEsc","key","parentNode","init","trapFocus","thumbBounds","thumbWrapperBounds","scrollLeft","offsetLeft","scrollWidth","clientWidth","scrollRight","ProductGallery","isQuickshop","viewer","navigation","navScroller","navScrollerButtons","figures","zoomButton","selected","figure","thumbnail","models","videos","selectedVideo","selectedModel","showingInitialSlide","_setupSelectedVideo","features","name","version","onLoad","viewInYourSpaceEl","_onViewInYourSpaceClick","_onModelLibraryLoad","Shopify","loadFeatures","_setSlideHeight","_onThumbnailClick","onZoomButtonClick","stopPropagation","_openImageZoom","_onResize","_setupFlickity","_selectMediaByEl","variant","featured_media","unwatch","_closeImageZoom","_disableHoverZoom","_disableFlickity","onPlayListener","flickity","unbindDrag","onPauseListener","bindDrag","figureEl","modelEl","galleryIndex","fullscreenEnabled","ModelViewerUI","fullscreenElement","drift","_setupHoverZoom","_adjustGalleryPositioning","button","contains","_selectMediaByIndex","shopifyModel3dId","setAttribute","figureIndex","media","selectedMediaType","defaultModelId","shouldAutoplay","gallery_video_autoplay","videoElement","Plyr","active","gallery_video_looping","hover_zoom","selectedImage","Drift","paneContainer","inlinePane","hoverBoundingBox","handleTouch","onShow","productMain","productAlt","onHide","disable","Flickity","accessibility","adaptiveHeight","cellSelector","contain","friction","freeScroll","initialIndex","lazyLoad","percentPosition","prevNextButtons","pageDots","selectedAttraction","setGallerySize","wrapAround","flickityEvent","pointer","cellElement","model","blur","swiped","unregister","containerHeight","storedImageHeight","height","style","thumbnail_position","productGalleryThumbs","firstChild","activeButton","activeElement","insertBefore","leftmostBounds","thumbStyle","currentStyle","thumbMargin","marginLeft","wrapped","Array","prototype","call","maxWidth","firstElementChild","_adjustMobileThumbnailPosition","imageZoom","ProductClicktoZoom","ProductDetails","$window","$formArea","$details","context","product","useHistory","sectionId","initialVariant","variantHelper","addToCartFlyout","atcCallbacks","$form","$productAtcButton","$productVariants","$productOptions","detailsLink","detailsBaseHref","variantFields","$price","$priceMoney","$compareAtPrice","$compareAtPriceMoney","$badge","$badgeMoneySaved","$badgePercentSaved","$sku","unitPrice","totalQuantity","unitPriceAmount","unitPriceMeasure","taxLine","forms","gallery","_bindEvents","_initOptions","_switchVariant","_addToCartFlyout","ShopifyVariants","mixedControls","selectVariant","firstLoad","selectMediaByVariant","_updatePrice","_updateSKU","_updateBadge","_updateButton","_updateSwatchLabel","_updateFullDetailsLink","_updateUnitPrice","url","handle","param","replaceState","hasComparePrice","compare_at_price","price","text","formatMoney","money_format","sku","parent","priceSaved","toggle","percentileSaved","Math","round","available","product_available","prop","product_unavailable","swatches_enable","swatchLabel","innerText","optionSwatchValue","unit_price_measurement","quantity_value","quantity_unit","unit_price","reference_value","reference_unit","taxable","preventDefault","formData","serializeArray","atcButton","moneyFormat","cartRedirection","cart_redirection","AddToCartFlyout","MessageBanner","message","type","bannerTemplate","banner","messageElement","header","bannerAnimation","transition","animateTo","_close","_handleDocumentClick","_closeEsc","$parent","parents","Images","images","size","imageArray","loadImage","getSizedImageUrl","path","image","Image","removeProtocol","prefix","suffix","console","warn","callbacks","flyOutSelector","atcTemplate","itemId","flyOut","_onInit","_onError","_onSuccess","_onCloseAll","onInit","onError","onSuccess","onClose","_closeFlyOut","messageBanner","_disableAtcButton","_updateCart","quantityField","quantity","ajax","Theme","routes","cart_add_url","dataType","done","response","imageUrl","productImage","product_title","productTitle","variant_options","productOptions","join","productPriceQuantity","cart_url","secondResponse","lineItem","items","item","line_level_discount_allocations","concat","final_price","productPriceValue","original_price","productPriceDiscounted","productDiscounts","unitPriceString","discountItemTemplate","discount","listItem","title","amount","discount_application","subTotal","total_price","itemCount","item_count","setupRippleEffect","dispatchEvent","Event","_enableAtcButton","atcAnimation","fail","errorText","responseText","JSON","parse","description","error","status","statusText","documentClickEventTarget","removeAttribute"],"mappings":"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","file":"DynamicFeaturedCollection-DynamicProduct-StaticCollection-StaticProduct-StaticProductRecommendations-724f8050.bundle.js","sourcesContent":["import $ from 'jquery';\n\nconst eventHandlers = [];\nlet previousBreakpoint = null;\n\nfunction getBreakpoints() {\n  return window\n    .getComputedStyle(document.documentElement, ':before')\n    .getPropertyValue('content')\n    .replace(/\"/g, '')\n    .split(',');\n}\n\nfunction getBreakpoint() {\n  return window\n    .getComputedStyle(document.documentElement, ':after')\n    .getPropertyValue('content')\n    .replace(/\"/g, '');\n}\n\n$(window).on('resize', event => {\n  const currentBreakpoint = getBreakpoint();\n\n  if (previousBreakpoint !== currentBreakpoint) {\n    eventHandlers.forEach(eventHandler => {\n      eventHandler(event, {\n        previous: previousBreakpoint,\n        current: currentBreakpoint,\n      });\n    });\n  }\n\n  previousBreakpoint = currentBreakpoint;\n});\n\nfunction isLessThanBreakpoint(breakpoint, inclusive = false) {\n  const breakpoints = getBreakpoints();\n  const currentBreakpoint = getBreakpoint();\n  const comparison = breakpoints.indexOf(currentBreakpoint) - breakpoints.indexOf(breakpoint);\n\n  return inclusive ? comparison <= 0 : comparison < 0;\n}\n\nfunction isGreaterThanBreakpoint(breakpoint, inclusive = false) {\n  const breakpoints = getBreakpoints();\n  const currentBreakpoint = getBreakpoint();\n  const comparison = breakpoints.indexOf(currentBreakpoint) - breakpoints.indexOf(breakpoint);\n\n  return inclusive ? comparison >= 0 : comparison > 0;\n}\n\nfunction isBreakpoint(...breakpoints) {\n  const currentBreakpoint = getBreakpoint();\n  return breakpoints.some(breakpoint => breakpoint === currentBreakpoint);\n}\n\nfunction onBreakpointChange(eventHandler) {\n  if (eventHandlers.indexOf(eventHandler) === -1) {\n    eventHandlers.push(eventHandler);\n  }\n}\n\nfunction offBreakpointChange(eventHandler) {\n  const index = eventHandlers.indexOf(eventHandler);\n\n  if (index !== -1) {\n    eventHandlers.splice(index, 1);\n  }\n}\n\nexport default {\n  isLessThanBreakpoint,\n  isGreaterThanBreakpoint,\n  isBreakpoint,\n  onBreakpointChange,\n  offBreakpointChange,\n};\n","export default class Quantity {\n  constructor(el) {\n    this.$el = $(el);\n    this.$inputParent = this.$el.find('.form-field--qty-input');\n    this.$input = this.$el.find('[data-quantity-input]');\n    this.$selectParent = this.$el.find('.form-field--qty-select');\n    this.$select = this.$el.find('[data-quantity-select]');\n\n    this._watchSelect = this._watchSelect.bind(this);\n    this._watchInput = this._watchInput.bind(this);\n\n    this.$select.on('change.quantity', this._watchSelect);\n    this.$input.on('change.quantity', this._watchInput);\n  }\n\n  unload() {\n    this.$el.off('.quantity');\n  }\n\n  _validateValue(event) {\n    const baseValue = parseInt(event.currentTarget.value, 10);\n\n    return isNaN(baseValue) ? 1 : baseValue;\n  }\n\n  _watchSelect(event) {\n    const value = this._validateValue(event);\n\n    // Update input to match select\n    this.$input.val(value).trigger('change');\n\n    // Switch to quantity input when 10 or more\n    if (value >= 10) {\n      this.$inputParent\n        .removeClass('hidden')\n        .addClass('visible');\n\n      this.$input\n        .focus()\n        .removeAttr('tabindex')\n        .select();\n\n      this.$selectParent\n        .removeClass('visible')\n        .addClass('hidden');\n\n      this.$select.attr('tabindex', '-1');\n    }\n  }\n\n  _watchInput(event) {\n    this.$input.val(this._validateValue(event));\n  }\n}\n","import $ from 'jquery';\nimport Quantity from './helpers/Quantity';\n\nexport default class Forms {\n  constructor(el, selector = '.form-field-input') {\n    this.$el = $(el);\n    this.filledClass = 'form-field-filled';\n    this.fieldSelector = selector;\n\n    this.quantityItems = [];\n    this.$quantityWrapper = this.$el.find('[data-quantity-wrapper]');\n\n    this._toggleFilled = this._toggleFilled.bind(this);\n    this.$el.on('focus.forms', this.fieldSelector, this._toggleFilled);\n    this.$el.on('blur.forms', this.fieldSelector, this._toggleFilled);\n\n    this._checkFilled();\n\n    if (this.$quantityWrapper.length) {\n      this.$quantityWrapper.each((i, el) => {\n        this.quantityItems.push(\n          new Quantity(el),\n        );\n      });\n    }\n  }\n\n  unload() {\n    this.$el.off('.forms');\n\n    this.quantityItems.forEach(quantityItem => {\n      quantityItem.unload();\n    });\n  }\n\n  _checkFilled() {\n    this.$el.find(this.fieldSelector).each((i, el) => {\n      if ($(el).hasClass(this.filledClass)) return;\n\n      this._toggleFilled(null, el);\n    });\n  }\n\n  _toggleFilled(event = null, el = false) {\n    const target = event ? event.currentTarget : el;\n    const $target = $(target);\n    const { value } = target;\n\n    let isFilled = value.length > 0;\n\n    try {\n      isFilled = isFilled || $target.is(':-webkit-autofill');\n      $target.toggleClass(this.filledClass, isFilled);\n    } catch (e) {\n      $target.toggleClass(this.filledClass, isFilled);\n    }\n  }\n}\n","import fitvids from 'fitvids';\nimport GroupedContent from 'grouped-content';\n\nexport default class RichText {\n  constructor($el) {\n    this.$el = $el;\n    this._initExternalLinks();\n    this.groupedContent = null;\n\n    if (this.$el.length) {\n      this.groupedContent = new GroupedContent($el.get(0), {\n        layout: 'tabs',\n        intelliparse: false,\n      });\n\n      fitvids('.rte');\n    }\n  }\n\n  unload() {\n    if (this.groupedContent) {\n      this.groupedContent.unload();\n    }\n  }\n\n  /**\n   * Open links within an RTE field in a new window if they point to external domains\n   *\n   * @private\n   */\n  _initExternalLinks() {\n    const anchors = this.$el.find('a[href^=\"http\"]').filter((i, el) => el.href.indexOf(location.hostname) === -1);\n    anchors.attr('target', '_blank');\n  }\n}\n","import $script from 'scriptjs';\n\nconst api = 'https://www.youtube.com/iframe_api';\nlet apiLoadedCallbacks = [];\nlet apiLoaded = false;\n\nwindow.onYouTubeIframeAPIReady = () => {\n  apiLoadedCallbacks.forEach(apiLoadedCallback => apiLoadedCallback());\n  apiLoadedCallbacks = [];\n  apiLoaded = true;\n};\n\nexport default class Youtube {\n  constructor({ el, videoUrl, loop }) {\n    const regex = /(?:youtube\\.com\\/(?:[^\\/]+\\/.+\\/|(?:v|e(?:mbed)?)\\/|.*[?&]v=)|youtu\\.be\\/)([^\"&?\\/ ]{11})/i; // eslint-disable-line no-useless-escape\n\n    this.el = el;\n    this.id = videoUrl.match(regex)[1] || null;\n\n    this.onApiLoaded = this._onApiLoaded.bind(this);\n\n    this.isReady = false;\n    this.onReady = this._onReady.bind(this);\n    this.onReadyCallback = null;\n    this.loop = loop ? 1 : 0;\n\n    this.onStateChange = this._onStateChange.bind(this);\n    this.onPlayCallback = null;\n\n    if (apiLoaded) {\n      this._onApiLoaded();\n    } else {\n      apiLoadedCallbacks.push(this.onApiLoaded);\n      $script(api);\n    }\n  }\n\n  play() {\n    return new Promise(resolve => {\n      this.onPlayCallback = resolve;\n\n      if (this.isReady) {\n        this.player.playVideo();\n      } else {\n        this.onReadyCallback = () => { this.player.playVideo(); };\n      }\n    });\n  }\n\n  pause() {\n    return new Promise(resolve => {\n      this.onPlayCallback = resolve;\n\n      if (this.isReady) {\n        this.player.pauseVideo();\n      } else {\n        this.onReadyCallback = () => { this.player.pauseVideo(); };\n      }\n    });\n  }\n\n  autoplay() {\n    return new Promise(resolve => {\n      this.onPlayCallback = resolve;\n\n      if (this.isReady) {\n        this.player.playVideo();\n        this.player.mute();\n      } else {\n        this.onReadyCallback = () => {\n          this.player.playVideo();\n          this.player.mute();\n        };\n      }\n    });\n  }\n\n  unload() {\n    this.player.destroy();\n  }\n\n  _onApiLoaded() {\n    const playerVars = {\n      modestbranding: true,\n      showinfo: false,\n      controls: false,\n      loop: this.loop,\n      rel: 0,\n    };\n\n    if (this.loop) {\n      // This is required to allow 'loop' to work based on the YouTube api\n      playerVars.playlist = this.id;\n    }\n\n    this.player = new YT.Player(this.el, {\n      videoId: this.id,\n      playerVars,\n      events: {\n        onReady: this.onReady,\n        onStateChange: this.onStateChange,\n      },\n    });\n  }\n\n  _onReady() {\n    this.isReady = true;\n\n    if (this.onReadyCallback) {\n      this.onReadyCallback();\n    }\n  }\n\n  _onStateChange(event) {\n    const state = event.data;\n    if (\n      this.onPlayCallback\n      && state === YT.PlayerState.BUFFERING\n    ) {\n      this.onPlayCallback();\n      this.onPlayCallback = null;\n    }\n  }\n}\n","import $script from 'scriptjs';\n\nconst api = 'https://player.vimeo.com/api/player.js';\nlet apiLoaded = false;\n\nexport default class VimeoPlayer {\n  constructor({ el, videoUrl }) {\n    this.el = el;\n    const urlParts = videoUrl.split('/');\n\n    this.id = urlParts[urlParts.length - 1];\n    this.onReadyCallback = null;\n\n    this.onApiLoaded = this._onApiLoaded.bind(this);\n\n    this.onProgress = this._onProgress.bind(this);\n    this.onProgressCallback = null;\n\n    if (apiLoaded) {\n      this._onApiLoaded();\n    } else {\n      $script(api, this.onApiLoaded);\n    }\n  }\n\n  play() {\n    return new Promise(resolve => {\n      this.onProgressCallback = resolve;\n\n      if (apiLoaded) {\n        this.player.on('play', this.onProgress);\n        this.player.play();\n      } else {\n        this.onReadyCallback = () => {\n          this.player.on('play', this.onProgress);\n          this.player.play();\n        };\n      }\n    });\n  }\n\n  pause() {\n    return new Promise(resolve => {\n      this.onProgressCallback = resolve;\n\n      if (apiLoaded) {\n        this.player.on('pause', this.onProgress);\n        this.player.pause();\n      } else {\n        this.onReadyCallback = () => {\n          this.player.on('pause', this.onProgress);\n          this.player.pause();\n        };\n      }\n    });\n  }\n\n  autoplay() {\n    return new Promise(resolve => {\n      this.onProgressCallback = resolve;\n\n      if (apiLoaded) {\n        this.player.on('play', this.onProgress);\n        this.player.setVolume(0);\n        this.player.play();\n      } else {\n        this.onReadyCallback = () => {\n          this.player.on('play', this.onProgress);\n          this.player.setVolume(0);\n          this.player.play();\n        };\n      }\n    });\n  }\n\n  unload() {\n    this.player\n      .unload()\n      .catch();\n  }\n\n  _onApiLoaded() {\n    this.player = new window.Vimeo.Player(this.el, { id: this.id });\n\n    this.player\n      .ready()\n      .then()\n      .catch();\n\n    apiLoaded = true;\n\n    if (this.onReadyCallback) {\n      this.onReadyCallback();\n    }\n  }\n\n  _onProgress() {\n    this.player.off('play', this.onProgress);\n    this.player.off('pause', this.onProgress);\n\n    if (this.onProgressCallback) {\n      this.onProgressCallback();\n      this.onProgressCallback = null;\n    }\n  }\n}\n","import Youtube from './Youtube';\nimport Vimeo from './Vimeo';\n\nexport default class Video {\n  constructor(el, options) {\n    this.el = el;\n    this.options = options;\n    this.platform = el.getAttribute('data-video').trim();\n    this.playButton = el.querySelector('[data-video-play-button]');\n    this.videoEl = el.querySelector('[data-video-element]');\n\n    this.onPlayClick = this._onPlayClick.bind(this);\n    this.onPauseClick = this._onPauseClick.bind(this);\n    this.autoplay = this._autoplay.bind(this);\n\n    this.video = null;\n\n    this.videoData = {\n      el: this.videoEl.childNodes[0],\n      videoUrl: this.videoEl.getAttribute('data-video-url'),\n      loop: this.options && this.options.loop,\n    };\n\n    switch (this.platform) {\n      case 'youtube':\n        this.video = new Youtube(this.videoData);\n        break;\n      case 'vimeo':\n        this.video = new Vimeo(this.videoData);\n        break;\n      default:\n        this.video = null;\n        break;\n    }\n\n    this.el.addEventListener('click', this.onPlayClick);\n\n    if (this.playButton) {\n      if (this.options && this.options.autoplay) {\n        this.autoplay();\n      }\n\n      this.playButton.addEventListener('click', this.onPlayClick);\n    }\n  }\n\n  _onPlayClick() {\n    this.el.classList.add('video-loading');\n\n    this.video.play()\n      .then(() => {\n        this.el.classList.add('video-transitioning');\n\n        setTimeout(() => {\n          this.el.classList.remove('video-loading');\n          this.el.classList.remove('video-transitioning');\n          this.el.classList.add('video-playing');\n        }, 200);\n      });\n  }\n\n  _onPauseClick() {\n    this.video.pause();\n  }\n\n  _autoplay() {\n    this.el.classList.add('video-loading');\n\n    this.video.autoplay()\n      .then(() => {\n        this.el.classList.add('video-transitioning');\n\n        setTimeout(() => {\n          this.el.classList.remove('video-loading');\n          this.el.classList.remove('video-transitioning');\n          this.el.classList.add('video-playing');\n        }, 200);\n      });\n  }\n\n  play() {\n    this._onPlayClick();\n  }\n\n  pause() {\n    this._onPauseClick();\n  }\n\n  unload() {\n    this.el.removeEventListener('click', this.onPlayClick);\n\n    if (this.playButton) {\n      this.playButton.removeEventListener('click', this.onPlayClick);\n    }\n\n    if (this.video) {\n      this.video.unload();\n    }\n  }\n\n  destroy() {\n    this.unload();\n  }\n}\n","import PhotoSwipe from 'photoswipe';\nimport EventHandler from '@pixelunion/events';\nimport rimg from 'rimg-shopify';\nimport {\n  trapFocus,\n  removeTrapFocus,\n} from '@shopify/theme-a11y';\n\nimport photoswipeUi from '../../../node_modules/photoswipe/dist/photoswipe-ui-default';\n\nimport layout from '../Layout';\n\nexport default class ProductClickToZoom {\n  constructor({\n    settings,\n    slides,\n    originalThumbnails,\n    startIndex,\n    selectGalleryIndex,\n  }) {\n    this.settings = settings;\n\n    this.photoswipeDialog = document.querySelector('[data-photoswipe]');\n    this.thumbContainer = this.photoswipeDialog.querySelector('[data-photoswipe-thumbs]');\n    this.thumbScroller = this.photoswipeDialog.querySelector('[data-photoswipe-thumb-scroller]');\n    this.thumbScrollerButtons = this.photoswipeDialog.querySelectorAll('[data-gallery-scroll-button]');\n    this.closeButton = this.photoswipeDialog.querySelector('.pswp__button--close');\n    this.selectedSlide = slides[startIndex];\n\n    this.thumbScroller.innerHTML = '';\n    this.thumbnails = [];\n\n    let selectedIndex = startIndex;\n\n    // Clone the original thumbnails into the photoswipe dialog\n    originalThumbnails.forEach((thumb, thumbIndex) => {\n      if (thumb.dataset.mediaType !== 'image') {\n        if (startIndex > thumbIndex) selectedIndex--;\n        return;\n      }\n      const newThumb = thumb.cloneNode(true);\n      this.thumbScroller.appendChild(newThumb);\n      this.thumbnails.push(newThumb);\n    });\n\n    rimg.watch(this.thumbContainer);\n\n    this.selectedThumb = this.thumbContainer.querySelector('[data-gallery-selected=\"true\"]');\n\n    this.events = new EventHandler();\n\n    // Set up options for initializing PhotoSwipe\n    const photoswipeSlides = [];\n\n    slides.forEach(slide => {\n      if (['video', 'external_video', 'model'].indexOf(slide.dataset.mediaType) > -1) return;\n      photoswipeSlides.push({\n        src: slide.dataset.zoom,\n        msrc: slide.dataset.zoom,\n        h: slide.dataset.imageHeight,\n        w: slide.dataset.imageWidth,\n      });\n    });\n\n    // Adjust the bottom bar height to allow for the mobile thumbnails\n    const bottomBarHeight = layout.isGreaterThanBreakpoint('L', true) ? 0 : 75;\n\n    const photoswipeOptions = {\n      index: selectedIndex,\n      barsSize: { top: 0, bottom: bottomBarHeight },\n      fullscreenEl: false,\n      zoomEl: false,\n      shareEl: false,\n      counterEl: false,\n      arrowEl: false,\n      preloaderEl: false,\n      closeOnScroll: false,\n      showHideOpacity: true,\n      history: false,\n      loop: true,\n      clickToCloseNonZoomable: false,\n      timeToIdle: false,\n      timeToIdleOutside: false,\n    };\n\n    if (this.settings.click_to_zoom === 'always'\n      || (layout.isGreaterThanBreakpoint('S', true) && this.settings.click_to_zoom === 'desktop')\n      || (layout.isLessThanBreakpoint('S') && this.settings.click_to_zoom === 'mobile')) {\n      photoswipeOptions.getThumbBoundsFn = () => {\n        const pageYScroll = window.pageYOffset || document.documentElement.scrollTop;\n        const bounds = this.selectedSlide.querySelector('[data-rimg]').getBoundingClientRect();\n        return { x: bounds.left, y: bounds.top + pageYScroll, w: bounds.width };\n      };\n    }\n\n    this.photoswipe = new PhotoSwipe(\n      this.photoswipeDialog,\n      photoswipeUi,\n      photoswipeSlides,\n      photoswipeOptions,\n    );\n\n    this.events.register(this.closeButton, 'click', () => this.photoswipe.close());\n    // The following fixes an issue on iOS12 and below, where click events were not registering\n    this.events.register(this.closeButton, 'touchstart', () => this.photoswipe.close());\n\n    this.thumbnails.forEach((thumb, index) => {\n      this.events.register(thumb, 'click', () => {\n        this.photoswipe.goTo(index);\n      });\n    });\n\n    this.events.register(this.thumbScroller, 'scroll', () => this._handleScrollButtonVisibility());\n    this.events.register(this.thumbScrollerButtons[0], 'click', () => this._onScrollButtonClick(true));\n    this.events.register(this.thumbScrollerButtons[1], 'click', () => this._onScrollButtonClick(false));\n\n    // Photoswipe documentation claims that the closeOnVerticalDrag option is always false if\n    // the mouse is used, which is what we want. Unfortunately that's not how it actually works,\n    // so we need to dynamically update the setting when a mouse is detected.\n    if (this.photoswipe.options.mouseUsed) {\n      this.photoswipe.options.closeOnVerticalDrag = false;\n    } else {\n      this.photoswipe.listen('mouseUsed', () => {\n        this.photoswipe.options.closeOnVerticalDrag = false;\n      });\n    }\n\n    this.photoswipe.listen('afterChange', () => {\n      const index = this.photoswipe.getCurrentIndex();\n      if (this.selectedThumb) {\n        this.selectedThumb.dataset.gallerySelected = false;\n      }\n      this.selectedThumb = this.thumbnails[index];\n      this.selectedThumb.dataset.gallerySelected = true;\n\n      const slideIndex = this.selectedThumb.getAttribute('data-gallery-index');\n      const slide = slides[slideIndex];\n\n      this._adjustMobileThumbPosition();\n      this._handleScrollButtonVisibility();\n\n      selectGalleryIndex(slideIndex);\n      this.selectedSlide = slide;\n    });\n\n    this.photoswipe.listen('close', () => {\n      removeTrapFocus(this.photoswipeDialog);\n      this.selectedSlide.focus();\n      this.photoswipe = null;\n    });\n\n    this.photoswipe.listen('destroy', () => {\n      this.events.unregisterAll();\n      this.photoswipe = null;\n    });\n\n    // Detect if mouse is over the thumbnails, if it is allow scroll left/right\n    this.events.register(this.thumbContainer, 'mouseenter', () => {\n      if (layout.isLessThanBreakpoint('S')) {\n        this.photoswipe.options.closeOnScroll = true;\n      }\n    });\n\n    this.events.register(this.thumbContainer, 'mouseleave', () => {\n      if (layout.isLessThanBreakpoint('S')) {\n        this.photoswipe.options.closeOnScroll = false;\n      }\n    });\n\n    // If a user closes the dialog using the escape key, then we should focus\n    // on the expand button.\n    const closeEsc = e => {\n      if (e.key === 'Escape') {\n        slides[0].parentNode.querySelector('[data-gallery-expand]').focus();\n      }\n    };\n\n    this.events.register(window, 'keydown', e => closeEsc(e));\n\n    this.photoswipe.init();\n\n    trapFocus(this.photoswipeDialog);\n  }\n\n  _adjustMobileThumbPosition() {\n    // This brings the thumbnail into view if it is not visible on the screen after\n    // a user swipes to a slide that it is tied to.\n    if (layout.isLessThanBreakpoint('S')) {\n      const thumbBounds = this.selectedThumb.getBoundingClientRect();\n      const thumbWrapperBounds = this.thumbScroller.getBoundingClientRect();\n\n      if (thumbBounds.left + thumbBounds.width + 30 > thumbWrapperBounds.width) {\n        this.thumbScroller.scrollLeft = this.selectedThumb.offsetLeft\n          + thumbBounds.width - thumbWrapperBounds.width + 35;\n      } else if (this.selectedThumb.offsetLeft < this.thumbScroller.scrollLeft) {\n        this.thumbScroller.scrollLeft = this.selectedThumb.offsetLeft - 35;\n      }\n    }\n  }\n\n  _handleScrollButtonVisibility() {\n    if (layout.isLessThanBreakpoint('S')) {\n      // We use 4px here just to ensure the user has scrolled a little bit before\n      // showing the buttons.\n      if (this.thumbScroller.scrollLeft > 4) {\n        this.thumbScrollerButtons[0].classList.add('visible');\n      } else {\n        this.thumbScrollerButtons[0].classList.remove('visible');\n      }\n\n      if (this.thumbScroller.scrollLeft < this.thumbScroller.scrollWidth\n        - this.thumbScroller.clientWidth) {\n        this.thumbScrollerButtons[1].classList.add('visible');\n      } else {\n        this.thumbScrollerButtons[1].classList.remove('visible');\n      }\n    } else {\n      this.thumbScrollerButtons[0].classList.remove('visible');\n      this.thumbScrollerButtons[1].classList.remove('visible');\n    }\n  }\n\n  _onScrollButtonClick(scrollRight) {\n    if (scrollRight) {\n      this.thumbScroller.scrollLeft = this.thumbScroller.scrollLeft - 100;\n    } else {\n      this.thumbScroller.scrollLeft = this.thumbScroller.scrollLeft + 100;\n    }\n  }\n\n  unload() {\n    if (this.photoswipe) {\n      this.photoswipe.destroy();\n      this.photoswipe = null;\n    }\n  }\n}\n","import Drift from 'drift-zoom';\nimport Flickity from 'flickity';\nimport EventHandler from '@pixelunion/events';\nimport rimg from 'rimg-shopify';\n\nimport layout from '../Layout';\nimport Video from './Video';\nimport ProductClicktoZoom from './ProductClickToZoom';\n\nexport default class ProductGallery {\n  constructor({ el, settings, isQuickshop }) {\n    this.el = el;\n    this.settings = settings;\n    this.isQuickshop = isQuickshop || false;\n\n    this.events = new EventHandler();\n    this.viewer = this.el.querySelector('[data-gallery-viewer]');\n    this.navigation = this.el.querySelector('[data-gallery-navigation]');\n    this.navScroller = this.el.querySelector('[data-gallery-scroller]');\n    this.navScrollerButtons = this.el.querySelectorAll('[data-gallery-scroll-button]');\n    this.figures = this.viewer.querySelectorAll('[data-gallery-figure]');\n    this.thumbnails = this.navigation.querySelectorAll('[data-gallery-thumbnail]');\n    this.zoomButton = this.viewer.querySelector('[data-gallery-expand]');\n\n    this.selected = {\n      figure: this.viewer.querySelector('[data-gallery-selected=\"true\"]'),\n      thumbnail: this.navigation.querySelector('[data-gallery-selected=\"true\"]'),\n    };\n\n    this.models = {};\n    this.videos = {};\n    this.selectedVideo = null;\n    this.selectedModel = null;\n    this.showingInitialSlide = true;\n\n    this._setupSelectedVideo = this._setupSelectedVideo.bind(this);\n\n    const features = [];\n    if (this.el.querySelector('[data-media-type=\"video\"]')) {\n      features.push({\n        name: 'video-ui',\n        version: '1.0',\n        onLoad: () => this._setupSelectedVideo(),\n      });\n    }\n\n    if (this.el.querySelector('[data-media-type=\"model\"]')) {\n      this.viewInYourSpaceEl = this.el.querySelector('[data-shopify-xr]');\n      this.events.register(this.viewInYourSpaceEl, 'click', () => this._onViewInYourSpaceClick());\n\n      features.push(\n        {\n          name: 'model-viewer-ui',\n          version: '1.0',\n          onLoad: this._onModelLibraryLoad.bind(this),\n        },\n      );\n      features.push(\n        {\n          name: 'shopify-xr',\n          version: '1.0',\n        },\n      );\n    }\n\n    if (features.length) {\n      window.Shopify.loadFeatures(features);\n    }\n\n    if (this.isQuickshop) {\n      rimg.watch(this.el);\n      // Because of the way the quickshop is animated to open, if a video is first in the\n      // gallery the height of the slide will not be correct, so we need to wait until all the\n      // transitions end. This will only fire once, as opposed to listening to transitionend.\n      if (this.figures[0].dataset.mediaType === 'video') {\n        setTimeout(() => this._setSlideHeight(), 800);\n      }\n    }\n\n    this.events.register(this.navScroller, 'click', e => this._onThumbnailClick(e));\n    this.events.register(this.navScroller, 'scroll', () => this._handleScrollButtonVisibility());\n    this.events.register(this.navScrollerButtons[0], 'click', () => this._onScrollButtonClick(true));\n    this.events.register(this.navScrollerButtons[1], 'click', () => this._onScrollButtonClick(false));\n\n    if (this.settings.click_to_zoom !== 'disabled') {\n      const onZoomButtonClick = e => {\n        e.stopPropagation();\n        this._openImageZoom();\n      };\n\n      this.events.register(this.zoomButton, 'click', e => onZoomButtonClick(e));\n      this.events.register(this.viewer, 'click', e => onZoomButtonClick(e));\n    }\n\n    this._onResize = this._onResize.bind(this);\n    this.events.register(window, 'resize', () => this._onResize());\n\n    if (layout.isLessThanBreakpoint('S')) {\n      this._setupFlickity();\n      this._handleScrollButtonVisibility();\n    }\n\n    this._selectMediaByEl(this.selected.figure);\n  }\n\n  selectMediaByVariant(variant) {\n    if (!variant.featured_media) return;\n    const slide = this.viewer.querySelector(`[data-media=\"${variant.featured_media.id}\"]`);\n\n    this._selectMediaByEl(slide);\n  }\n\n  unload() {\n    this.events.unregisterAll();\n\n    for (let i; i < this.figures.length; i++) {\n      if (this.models[i]) {\n        this.models[i].destroy();\n      }\n\n      if (this.videos[i]) {\n        this.videos[i].destroy();\n      }\n    }\n\n    if (this.isQuickshop) {\n      rimg.unwatch(this.el);\n    }\n\n    this._closeImageZoom();\n    this._disableHoverZoom();\n    this._disableFlickity();\n  }\n\n  _onModelLibraryLoad() {\n    const onPlayListener = () => {\n      if (this.flickity) {\n        this.flickity.unbindDrag();\n      }\n    };\n    const onPauseListener = () => {\n      if (this.flickity) {\n        this.flickity.bindDrag();\n      }\n    };\n    this.el.querySelectorAll('.product-gallery--model')\n      .forEach(figureEl => {\n        const modelEl = figureEl.querySelector('model-viewer');\n        const { galleryIndex } = figureEl.dataset;\n        const controls = ['zoom-in', 'zoom-out'];\n        if (document.fullscreenEnabled) controls.push('fullscreen');\n\n        this.models[galleryIndex] = new Shopify.ModelViewerUI(modelEl, { controls });\n\n        this.events.register(modelEl, 'shopify_model_viewer_ui_toggle_play', onPlayListener);\n        this.events.register(modelEl, 'shopify_model_viewer_ui_toggle_pause', onPauseListener);\n      });\n  }\n\n  _onResize() {\n    // If the resize was trigger by a fullscreen, do not do anything\n    if (document.fullscreenElement) {\n      return;\n    }\n\n    if (layout.isGreaterThanBreakpoint('S', true)) {\n      this._disableFlickity();\n    } else {\n      this._setupFlickity();\n    }\n\n    if (layout.isGreaterThanBreakpoint('L', true) && !this.drift) {\n      this._setupHoverZoom();\n    } else if (layout.isLessThanBreakpoint('L')) {\n      this._disableHoverZoom();\n    }\n\n    this._adjustGalleryPositioning();\n    this._handleScrollButtonVisibility();\n  }\n\n  _onThumbnailClick(e) {\n    let button;\n    this.showingInitialSlide = false;\n\n    // The target will be the button itself if the user is using a keyboard to navigate, but\n    // otherwise it will be the image that is clicked on.\n    if (e.target.classList.contains('product-gallery--media-thumbnail')) {\n      button = e.target;\n    } else if (e.target.parentNode.parentNode.classList\n      .contains('product-gallery--media-thumbnail')) {\n      button = e.target.parentNode.parentNode;\n    } else {\n      return;\n    }\n\n    const selectedIndex = parseInt(button.dataset.galleryIndex, 10);\n\n    if (this.flickity) {\n      this.flickity.select(selectedIndex);\n    } else {\n      this._selectMediaByIndex(selectedIndex);\n    }\n  }\n\n  _onViewInYourSpaceClick(e) {\n    const { currentTarget } = e;\n    const figure = this.viewer.querySelector(`[data-media=\"${currentTarget.dataset.shopifyModel3dId}\"]`);\n\n    this._selectMediaByEl(figure);\n  }\n\n  _selectMediaByEl(el) {\n    this._selectMediaByIndex(parseInt(el.dataset.galleryIndex, 10));\n  }\n\n  _selectMediaByIndex(index) {\n    const figure = this.figures[index];\n\n    this.selected.figure.dataset.gallerySelected = false;\n    this.selected.figure.setAttribute('aria-hidden', true);\n    this.selected.figure = figure;\n    this.selected.figure.dataset.gallerySelected = true;\n    this.selected.figure.setAttribute('aria-hidden', false);\n\n    const figureIndex = parseInt(this.selected.figure.dataset.galleryIndex, 10);\n\n    this.selected.thumbnail.dataset.gallerySelected = false;\n    this.selected.thumbnail = this.thumbnails[figureIndex];\n    this.selected.thumbnail.dataset.gallerySelected = true;\n\n    const { media, mediaType } = this.selected.figure.dataset;\n\n    this.viewer.dataset.selectedMediaType = mediaType;\n\n    this._disableHoverZoom();\n\n    if (this.selectedModel) {\n      this.selectedModel.pause();\n    }\n\n    if (this.models[figure.dataset.galleryIndex]) {\n      this.selectedModel = this.models[figure.dataset.galleryIndex];\n      if (!document.documentElement.classList.contains('has-touch') && !this.showingInitialSlide) {\n        this.selectedModel.play();\n      }\n    }\n\n    if (this.selectedVideo) {\n      this.selectedVideo.pause();\n    }\n\n    if (this.viewInYourSpaceEl) {\n      this.viewInYourSpaceEl.dataset.shopifyModel3dId = this.viewInYourSpaceEl.dataset.defaultModelId;\n    }\n\n    switch (mediaType) {\n      case 'model':\n        this.viewInYourSpaceEl.dataset.shopifyModel3dId = media;\n        break;\n      case 'video':\n      case 'external_video':\n        this._setupSelectedVideo();\n        break;\n      case 'image':\n        this._setupHoverZoom();\n        break;\n      default: break;\n    }\n\n    if (this.flickity) {\n      this.flickity.bindDrag();\n      this.flickity.select(index);\n    }\n\n    this._adjustGalleryPositioning();\n  }\n\n  _setupSelectedVideo() {\n    if (this.selectedVideo) {\n      this.selectedVideo.pause();\n    }\n\n    const { mediaType, galleryIndex } = this.selected.figure.dataset;\n    const shouldAutoplay = layout.isGreaterThanBreakpoint('L', true)\n      && this.settings.gallery_video_autoplay\n      && !this.showingInitialSlide;\n\n    if (mediaType === 'video' || mediaType === 'external_video') {\n      let videoElement;\n\n      if (this.videos[galleryIndex]) {\n        this.selectedVideo = this.videos[galleryIndex];\n        if (shouldAutoplay) this.selectedVideo.play();\n      } else {\n        if (mediaType === 'video') {\n          // Plyr hasn't loaded yet, will be called again after loadFeatures\n          if (!Shopify.Plyr) return;\n          videoElement = this.selected.figure.querySelector('video');\n\n          this.selectedVideo = new Shopify.Plyr(videoElement, {\n            loop: { active: this.settings.gallery_video_looping },\n          });\n          if (shouldAutoplay) this.selectedVideo.play();\n        } else {\n          videoElement = this.selected.figure.querySelector('[data-video]');\n          this.selectedVideo = new Video(videoElement, {\n            loop: this.settings.gallery_video_looping,\n          });\n          if (shouldAutoplay) this.selectedVideo.play();\n        }\n        this.videos[galleryIndex] = this.selectedVideo;\n      }\n      this.selected.figure.focus();\n    }\n  }\n\n  _setupHoverZoom() {\n    if (\n      this.settings.hover_zoom === 'disabled'\n      || !layout.isGreaterThanBreakpoint('L', true)\n      || this.selected.figure.dataset.mediaType !== 'image'\n      || document.documentElement.classList.contains('has-touch')\n    ) return;\n\n    const selectedImage = this.selected.figure.querySelector('[data-rimg]');\n    selectedImage.setAttribute('data-zoom', this.selected.figure.getAttribute('data-zoom'));\n\n    this.drift = new Drift(selectedImage, {\n      paneContainer: this.settings.hover_zoom === 'separate'\n        ? this.el.querySelector('[data-zoomed-image]')\n        : this.selected.figure,\n      inlinePane: false,\n      hoverBoundingBox: this.settings.hover_zoom === 'separate',\n      handleTouch: false,\n      onShow: () => {\n        if (this.settings.hover_zoom === 'separate') {\n          const productMain = document.querySelector('.product-main');\n          const productAlt = document.querySelector('.product-form--alt');\n          productMain.classList.add('product-gallery--fade');\n          if (productAlt) productAlt.classList.add('product-gallery--fade');\n        }\n      },\n      onHide: () => {\n        if (this.settings.hover_zoom === 'separate') {\n          const productMain = document.querySelector('.product-main');\n          const productAlt = document.querySelector('.product-form--alt');\n          productMain.classList.remove('product-gallery--fade');\n          if (productAlt) productAlt.classList.remove('product-gallery--fade');\n        }\n      },\n    });\n  }\n\n  _disableHoverZoom() {\n    if (this.drift) {\n      this.drift.disable();\n      this.drift = null;\n    }\n  }\n\n  _setupFlickity() {\n    if (\n      this.flickity\n      || !layout.isLessThanBreakpoint('S')\n    ) return;\n\n    this.flickity = new Flickity(this.viewer, {\n      accessibility: false,\n      adaptiveHeight: true,\n      cellSelector: '.product-gallery--media',\n      contain: true,\n      friction: 0.5,\n      freeScroll: false,\n      initialIndex: parseInt(this.selected.figure.dataset.galleryIndex, 10),\n      lazyLoad: false,\n      percentPosition: false,\n      prevNextButtons: false,\n      pageDots: false,\n      selectedAttraction: 0.1,\n      setGallerySize: false,\n      wrapAround: true,\n    });\n\n    this.flickityEvent = this.events.register(this.viewer, 'rimg:load', () => {\n      this._setSlideHeight();\n    });\n\n    this.flickity.on('change', index => {\n      this.showingInitialSlide = false;\n      this._selectMediaByEl(this.figures[index]);\n    });\n\n    // Flickity controls the pointerdown event which prevents model-viewer-ui from\n    // triggering .play() on mouseup. This returns this functionality.\n    this.flickity.on('staticClick', (event, pointer, cellElement) => {\n      const figure = cellElement.querySelector('.product-gallery--model');\n\n      if (figure && this.models[figure.dataset.galleryIndex]) {\n        const model = this.models[figure.dataset.galleryIndex];\n        model.play();\n      }\n    });\n\n    this.flickity.on('pointerDown', () => {\n      // Removes the focus ring when swiping with touch device\n      this.viewer.blur();\n    });\n\n    // We need to disable the product zoom open if a user is swiping\n    // This was an issue on mouse gestures, not on touch\n    if (this.settings.click_to_zoom !== 'disabled'\n      && document.documentElement.classList.contains('no-touch')) {\n      this.flickity.on('dragEnd', () => {\n        this.swiped = true;\n      });\n    }\n\n    this._setSlideHeight();\n  }\n\n  _disableFlickity() {\n    if (this.flickity) {\n      this.flickity.destroy();\n      this.flickity = null;\n      this.events.unregister(this.flickityEvent);\n    }\n  }\n\n  _setSlideHeight() {\n    this.navigation.classList.remove('loading');\n\n    // Use the stored image height for situations where the DOM is in a midway state.\n    const containerHeight = this.storedImageHeight\n      || this.selected.figure.getBoundingClientRect().height;\n    this.storedImageHeight = null;\n\n    this.viewer.style.height = `${containerHeight}px`;\n  }\n\n  _adjustGalleryPositioning() {\n    if (this.settings.thumbnail_position === 'left') {\n      if (this.isQuickshop) {\n        if (layout.isGreaterThanBreakpoint('L', true)) {\n          this.el.dataset.productGalleryThumbs = 'left';\n        } else {\n          this.storedImageHeight = this.selected.figure.getBoundingClientRect().height;\n          this.el.dataset.productGalleryThumbs = 'center';\n        }\n      }\n\n      // We need to adjust the width of the thumbnails if they are positioned left\n      // and they wrap into 2 columns. CSS flexbox does not cause the width of the\n      // element to stretch. Looks like it's a problem with flexbox when wrapping columns:\n      // https://stackoverflow.com/questions/33891709/when-flexbox-items-wrap-in-column-mode-container-does-not-grow-its-width\n      if (layout.isGreaterThanBreakpoint('L', true)\n        || (layout.isGreaterThanBreakpoint('S', true) && !this.isQuickshop)) {\n        if (this.el.firstChild !== this.navigation) {\n          const activeButton = document.activeElement;\n          this.el.insertBefore(this.navigation, this.viewer);\n          activeButton.focus(); // This prevents loss of focus if one of the thumbnails are selected\n        }\n\n        // When switching layouts in the editor sometimes we need to wait for a few milliseconds\n        // before positioning the thumbs. The Quickshop is even a bit slower.\n        setTimeout(() => {\n          const leftmostBounds = this.thumbnails[0].getBoundingClientRect();\n          const thumbStyle = this.thumbnails[0].currentStyle\n            || window.getComputedStyle(this.thumbnails[0]);\n          const thumbMargin = (parseInt(thumbStyle.marginLeft, 10)) * 2;\n          const wrapped = Array.prototype.some.call(this.thumbnails,\n            thumb => thumb.getBoundingClientRect().left > leftmostBounds.left);\n          if (wrapped) {\n            this.navigation.style.width = `${(leftmostBounds.width + thumbMargin) * 2}px`;\n            this.navigation.style.maxWidth = `${(leftmostBounds.width + thumbMargin) * 2}px`;\n          }\n          this._setSlideHeight();\n        }, this.isQuickshop ? 500 : 100);\n      } else {\n        if (this.el.firstElementChild === this.navigation) {\n          this.el.appendChild(this.navigation);\n        }\n        this.navigation.style.width = '';\n        this.navigation.style.maxWidth = '';\n        this._setSlideHeight();\n      }\n\n      if (layout.isLessThanBreakpoint('S')) {\n        this._adjustMobileThumbnailPosition();\n      }\n    } else {\n      this._setSlideHeight();\n      this._adjustMobileThumbnailPosition();\n    }\n  }\n\n  _adjustMobileThumbnailPosition() {\n    // This brings the thumbnail into view if it is not visible on the screen after\n    // a user swipes to a slide that it is tied to. Only important on mobile.\n    if (layout.isLessThanBreakpoint('S')) {\n      const thumbBounds = this.selected.thumbnail.getBoundingClientRect();\n      const thumbWrapperBounds = this.navScroller.getBoundingClientRect();\n\n      if (this.selected.thumbnail.offsetLeft + thumbBounds.width + 30\n        - this.navScroller.scrollLeft > thumbWrapperBounds.width) {\n        this.navScroller.scrollLeft = this.selected.thumbnail.offsetLeft\n          + thumbBounds.width - thumbWrapperBounds.width + 35;\n      } else if (this.selected.thumbnail.offsetLeft < this.navScroller.scrollLeft) {\n        this.navScroller.scrollLeft = this.selected.thumbnail.offsetLeft - 35;\n      }\n    }\n  }\n\n  _handleScrollButtonVisibility() {\n    if (layout.isLessThanBreakpoint('S')) {\n      // We use 4px here just to ensure the user has scrolled a little bit before\n      // showing the buttons.\n      if (this.navScroller.scrollLeft > 4) {\n        this.navScrollerButtons[0].classList.add('visible');\n      } else {\n        this.navScrollerButtons[0].classList.remove('visible');\n      }\n\n      if (this.navScroller.scrollLeft < this.navScroller.scrollWidth\n        - this.navScroller.clientWidth) {\n        this.navScrollerButtons[1].classList.add('visible');\n      } else {\n        this.navScrollerButtons[1].classList.remove('visible');\n      }\n    } else {\n      this.navScrollerButtons[0].classList.remove('visible');\n      this.navScrollerButtons[1].classList.remove('visible');\n    }\n  }\n\n  _onScrollButtonClick(scrollRight) {\n    if (scrollRight) {\n      this.navScroller.scrollLeft = this.navScroller.scrollLeft - 100;\n    } else {\n      this.navScroller.scrollLeft = this.navScroller.scrollLeft + 100;\n    }\n  }\n\n  _closeImageZoom() {\n    if (this.imageZoom) {\n      this.imageZoom.unload();\n      this.imageZoom = null;\n    }\n  }\n\n  _openImageZoom() {\n    if (this.selected.figure.dataset.mediaType !== 'image'\n      || (layout.isGreaterThanBreakpoint('L') && this.settings.click_to_zoom === 'mobile')\n      || (layout.isLessThanBreakpoint('L') && this.settings.click_to_zoom === 'desktop')\n    ) return;\n\n    if (this.swiped) {\n      this.swiped = false;\n      return;\n    }\n\n    this._closeImageZoom();\n\n    this.imageZoom = new ProductClicktoZoom({\n      settings: this.settings,\n      slides: this.figures,\n      originalThumbnails: this.thumbnails,\n      startIndex: parseInt(this.selected.figure.dataset.galleryIndex, 10),\n      selectGalleryIndex: index => this._selectMediaByIndex(index),\n    });\n  }\n}\n","import $ from 'jquery';\nimport ShopifyVariants from 'shopify-variants';\nimport Forms from '../Forms';\nimport AddToCartFlyout from './AddToCartFlyout';\nimport ProductGallery from './ProductGallery';\n\nexport default class ProductDetails {\n  constructor(options) {\n    this.$window = $(window);\n    this.$formArea = options.$formArea;\n    this.$details = options.$details;\n    this.context = options.context;\n    this.settings = options.settings;\n    this.product = options.product;\n    this.useHistory = options.useHistory;\n    this.sectionId = options.sectionId;\n    this.initialVariant = options.initialVariant || null;\n\n    this.variantHelper = null;\n    this.addToCartFlyout = null;\n\n    this.atcCallbacks = options.atcCallbacks;\n\n    // Form\n    this.$form = this.$formArea.find('[data-product-form]');\n    this.$productAtcButton = this.$formArea.find('[data-product-atc]');\n    this.$productVariants = this.$form.find('[data-variants]');\n    this.$productOptions = this.$form.find('[data-product-option]');\n    this.detailsLink = this.$formArea[0].querySelector('[data-product-details-link]');\n    if (this.detailsLink) {\n      this.detailsBaseHref = this.detailsLink.getAttribute('href');\n    }\n\n    this.variantFields = {\n      $price: this.$details.find('[data-price]'),\n      $priceMoney: this.$details.find('[data-price] .money'),\n      $compareAtPrice: this.$details.find('[data-price-compare-at]'),\n      $compareAtPriceMoney: this.$details.find('[data-price-compare-at] .money'),\n      $badge: this.$details.find('[data-badge-sales]'),\n      $badgeMoneySaved: this.$details.find('[data-price-money-saved]'),\n      $badgePercentSaved: this.$details.find('[data-price-percent-saved]'),\n      $sku: this.$details.find('[data-product-sku]'),\n      unitPrice: this.$details[0].querySelector('[data-unit-price]'),\n      totalQuantity: this.$details[0].querySelector('[data-total-quantity]'),\n      unitPriceAmount: this.$details[0].querySelector('[data-unit-price-amount]'),\n      unitPriceMeasure: this.$details[0].querySelector('[data-unit-price-measure]'),\n      taxLine: this.$details[0].querySelector('[data-tax-line]'),\n    };\n\n    this.forms = new Forms(this.$form);\n\n    if (this.product && 'media' in this.product) {\n      this.gallery = new ProductGallery({\n        el: options.gallery,\n        settings: this.settings,\n        isQuickshop: options.isQuickshop,\n      });\n    }\n\n    this._bindEvents();\n    this._initOptions();\n  }\n\n  unload() {\n    this.$form.off(`.product-details-${this.sectionId}`);\n    this.$window.off(`.product-details-${this.sectionId}`);\n    this.forms.unload();\n\n    if (this.variantHelper) {\n      this.variantHelper.unload();\n    }\n\n    if (this.gallery) {\n      this.gallery.unload();\n    }\n  }\n\n  _bindEvents() {\n    this.$window.on(`shopify-variants:switch-variant.product-details-${this.sectionId}`, (event, data) => this._switchVariant(event, data));\n    this.$form.on(`submit.product-details-${this.sectionId}`, event => this._addToCartFlyout(event));\n  }\n\n  _initOptions() {\n    if (!this.$productVariants.length) return;\n\n    this.variantHelper = new ShopifyVariants(\n      this.product,\n      this.$productVariants,\n      this.$productOptions,\n      { mixedControls: true },\n    );\n\n    this.variantHelper.selectVariant(this.initialVariant);\n  }\n\n  _switchVariant(event, data) {\n    if (data.product !== this.product) return;\n\n    const {\n      variant,\n      firstLoad,\n    } = data;\n\n    if (firstLoad) {\n      return;\n    }\n\n    // Update main select\n    this.$productVariants.val(data.variant.id);\n\n    if (this.gallery) {\n      this.gallery.selectMediaByVariant(variant);\n    }\n\n    // Update Variant information\n    this._updatePrice(variant);\n    this._updateSKU(variant);\n    this._updateBadge(variant);\n    this._updateButton(variant);\n    this._updateSwatchLabel(variant);\n    this._updateFullDetailsLink(variant);\n    this._updateUnitPrice(variant);\n\n    if (this.useHistory) {\n      const url = `${this.product.handle}?${$.param({ variant: variant.id })}`;\n      history.replaceState({}, 'variant', url);\n    }\n  }\n\n  _updatePrice(variant) {\n    // Update compare at price\n    const hasComparePrice = (\n      !!variant.compare_at_price && variant.compare_at_price > variant.price\n    );\n    this.variantFields.$compareAtPrice.toggleClass('visible', hasComparePrice);\n    this.variantFields.$compareAtPriceMoney.text(\n      Shopify.formatMoney(variant.compare_at_price, this.settings.money_format),\n    );\n\n    // Update price\n    this.variantFields.$priceMoney.text(\n      Shopify.formatMoney(variant.price, this.settings.money_format),\n    );\n  }\n\n  _updateSKU(variant) {\n    if (variant.sku === '') {\n      this.variantFields.$sku.parent().addClass('product-sku--empty');\n    } else {\n      this.variantFields.$sku.parent().removeClass('product-sku--empty');\n    }\n\n    this.variantFields.$sku.text(variant.sku);\n  }\n\n  _updateBadge(variant) {\n    const priceSaved = variant.compare_at_price ? variant.compare_at_price - variant.price : 0;\n    this.variantFields.$badge.toggle(!!priceSaved);\n\n    if (this.variantFields.$badgeMoneySaved.length) {\n      // Update badge if it shows money saved\n      this.variantFields.$badgeMoneySaved.text(\n        Shopify.formatMoney(priceSaved, this.settings.money_format),\n      );\n    }\n\n    if (this.variantFields.$badgePercentSaved.length) {\n      // Update badge if it shows percentiles\n      const percentileSaved = Math.round((priceSaved * 100) / variant.compare_at_price);\n      this.variantFields.$badgePercentSaved.text(percentileSaved);\n    }\n  }\n\n  _updateButton(variant) {\n    if (variant.available) {\n      this.$productAtcButton.text(this.context.product_available);\n      this.$productAtcButton\n        .removeClass('disabled')\n        .prop('disabled', false);\n    } else {\n      this.$productAtcButton.text(this.context.product_unavailable);\n      this.$productAtcButton\n        .addClass('disabled')\n        .prop('disabled', true);\n    }\n  }\n\n  _updateSwatchLabel(variant) {\n    if (this.settings.swatches_enable) {\n      const swatchLabel = this.$form[0].querySelector('[data-option-swatch-value]');\n      if (swatchLabel) {\n        swatchLabel.innerText = variant.options[parseInt(swatchLabel.dataset.optionSwatchValue, 10)];\n      }\n    }\n  }\n\n  _updateFullDetailsLink(variant) {\n    if (this.detailsLink) {\n      this.detailsLink.setAttribute('href', `${this.detailsBaseHref}?variant=${variant.id}`);\n    }\n  }\n\n  _updateUnitPrice(variant) {\n    if (this.variantFields.unitPrice && variant.unit_price_measurement) {\n      this.variantFields.totalQuantity.innerHTML = `${variant.unit_price_measurement.quantity_value}${variant.unit_price_measurement.quantity_unit}`;\n\n      this.variantFields.unitPriceAmount.innerHTML = Shopify.formatMoney(variant.unit_price, this.settings.money_format);\n      if (variant.unit_price_measurement.reference_value === 1) {\n        this.variantFields.unitPriceMeasure.innerHTML = variant.unit_price_measurement.reference_unit;\n      } else {\n        this.variantFields.unitPriceMeasure.innerHTML = `${variant.unit_price_measurement.reference_value}${variant.unit_price_measurement.reference_unit}`;\n      }\n      this.variantFields.unitPrice.classList.remove('hidden');\n    } else if (this.variantFields.unitPrice) {\n      this.variantFields.unitPrice.classList.add('hidden');\n    }\n\n    if (this.variantFields.taxLine) {\n      if (variant.taxable) {\n        this.variantFields.taxLine.classList.remove('hidden');\n      } else {\n        this.variantFields.taxLine.classList.add('hidden');\n      }\n    }\n  }\n\n  _addToCartFlyout(event) {\n    event.preventDefault();\n\n    if (this.addToCartFlyout) {\n      this.addToCartFlyout.unload();\n    }\n\n    const formData = this.$form.serializeArray();\n\n    const options = {\n      atcButton: this.$productAtcButton[0],\n      settings: {\n        moneyFormat: this.settings.money_format,\n        cartRedirection: this.settings.cart_redirection,\n      },\n    };\n\n    this.addToCartFlyout = new AddToCartFlyout(formData, options, this.atcCallbacks);\n  }\n}\n","import $ from 'jquery';\n\nimport { transition } from '@pixelunion/animations';\nimport EventHandler from '@pixelunion/events';\n\nexport default class MessageBanner {\n  constructor(message, type) {\n    const bannerTemplate = document.querySelector('[data-templates] [data-message-banner]');\n    this.banner = bannerTemplate.cloneNode(true);\n\n    const messageElement = this.banner.querySelector('[data-message-banner-content]');\n    messageElement.innerHTML = message;\n\n    this.banner.classList.add(`message--${type}`);\n\n    this.header = document.querySelector('[data-site-header]');\n    this.closeButton = this.banner.querySelector('[data-message-banner-close]');\n\n    this.header.appendChild(this.banner);\n\n    this.bannerAnimation = transition({ el: this.banner, state: 'closed' });\n    this.bannerAnimation.animateTo('open');\n\n    this.events = new EventHandler();\n\n    this.events.register(this.closeButton, 'click', () => this._close());\n    this.events.register(document, 'click', e => this._handleDocumentClick(e.target));\n    this.events.register(document, 'touchStart', e => this._handleDocumentClick(e.target));\n    this.events.register(window, 'keydown', e => this._closeEsc(e));\n  }\n\n  unload() {\n    if (this.banner) {\n      this._close();\n    }\n  }\n\n  _closeEsc(e) {\n    if (e.key === 'Escape') {\n      this._close();\n    }\n  }\n\n  _close() {\n    this.bannerAnimation.animateTo('closed').then(() => {\n      this.banner.remove();\n      this.banner = null;\n      this.events.unregisterAll();\n      this.bannerAnimation.unload();\n    });\n  }\n\n  _handleDocumentClick(target) {\n    const $parent = $(target).parents('[data-message-banner]');\n    if ($parent.length) return;\n\n    this._close();\n  }\n}\n","export default class Images {\n  /**\n   * Preloads an image in memory and uses the browsers cache to store it until needed.\n   *\n   * @param {Array} images - A list of image urls\n   * @param {String} size - A shopify image size attribute\n   */\n  preload(images, size) {\n    let imageArray = images;\n    if (typeof images === 'string') {\n      imageArray = [images];\n    }\n\n    for (let i = 0; i < imageArray.length; i++) {\n      this.loadImage(this.getSizedImageUrl(imageArray[i], size));\n    }\n  }\n\n  /**\n   * Loads and caches an image in the browsers cache.\n   *\n   * @param {string} path - An image url\n   */\n  loadImage(path) {\n    const image = new Image();\n    image.src = path;\n    return image;\n  }\n\n  /**\n   * Adds a Shopify size attribute to a URL\n   *\n   * @param src\n   * @param size\n   * @returns {*}\n   */\n  getSizedImageUrl(src = null, size) {\n    if (!size) {\n      return null;\n    }\n\n    if (size === 'master') {\n      return this.removeProtocol(src);\n    }\n\n    const match = src.match(/\\.(jpg|jpeg|gif|png|bmp|bitmap|tiff|tif)(\\?v=\\d+)?$/i);\n\n    if (match) {\n      const prefix = src.split(match[0]);\n      const suffix = match[0];\n\n      return this.removeProtocol(`${prefix[0]}_${size}${suffix}`);\n    }\n\n    console.warn(`No ${size} found for '${src}`);\n    return null;\n  }\n\n  removeProtocol(path) {\n    return path.replace(/http(s)?:/, '');\n  }\n}\n","import $ from 'jquery';\nimport {\n  trapFocus,\n  removeTrapFocus,\n} from '@shopify/theme-a11y';\nimport { transition } from '@pixelunion/animations';\nimport EventHandler from '@pixelunion/events';\n\nimport MessageBanner from './MessageBanner';\nimport Images from '../helpers/Images';\nimport { setupRippleEffect } from '../helpers/Ripple';\n\nexport default class AddToCartFlyout {\n  constructor(formData, options, callbacks = {}) {\n    this.formData = formData;\n    this.settings = {\n      moneyFormat: null,\n      cartRedirection: false,\n      ...options.settings,\n    };\n\n    this.atcButton = options.atcButton;\n\n    this.header = document.querySelector('[data-site-header]');\n    this.flyOutSelector = '[data-atc-banner]';\n    this.atcTemplate = document.querySelector(`[data-templates] ${this.flyOutSelector}`);\n\n    this.activeElement = document.activeElement;\n    this.itemId = null;\n    this.flyOut = null;\n\n    this._onInit = this._onInit.bind(this);\n    this._onError = this._onError.bind(this);\n    this._onSuccess = this._onSuccess.bind(this);\n    this._onCloseAll = this._onCloseAll.bind(this);\n\n    // Allows ATC Flow to be overridden\n    this.callbacks = {\n      onInit: this._onInit,\n      onError: this._onError,\n      onSuccess: this._onSuccess,\n      onClose: this._onCloseAll,\n      ...callbacks,\n    };\n\n    this._handleDocumentClick = this._handleDocumentClick.bind(this);\n    this._closeFlyOut = this._closeFlyOut.bind(this);\n    this._closeEsc = this._closeEsc.bind(this);\n\n    this.events = new EventHandler();\n\n    this.Images = new Images();\n    this.messageBanner = null;\n\n    this.callbacks.onInit();\n\n    this._disableAtcButton();\n    this._updateCart();\n  }\n\n  unload() {\n    if (this.messageBanner) {\n      this.messageBanner.unload();\n    }\n    this._closeFlyOut();\n  }\n\n  _updateCart() {\n    const flyOut = this.atcTemplate.cloneNode(true);\n\n    const quantityField = this.formData.filter(data => data.name === 'quantity');\n    const quantity = quantityField[0].value;\n\n    $.ajax({\n      type: 'POST',\n      url: `${window.Theme.routes.cart_add_url}.js`,\n      data: $.param(this.formData),\n      dataType: 'json',\n    })\n      .done(response => {\n        this.itemId = response.id;\n\n        if (response.image) {\n          const imageUrl = this.Images.getSizedImageUrl(response.image, '200x');\n          this.Images.loadImage(imageUrl);\n\n          const productImage = flyOut.querySelector('[data-atc-banner-product-image]');\n          productImage.innerHTML = `<img src=\"${imageUrl}\" alt=\"${response.product_title}\">`;\n        }\n\n        const productTitle = flyOut.querySelector('[data-atc-banner-product-title]');\n        productTitle.innerHTML = response.product_title;\n\n        /*\n          TODO: Bring in `variant.options`, iterate through to get option\n            name for: <strong>Option name:</strong> Option\n        */\n        if (response.variant_options[0] !== 'Title' && response.variant_options[0] !== 'Default Title') {\n          const productOptions = flyOut.querySelector('[data-atc-banner-product-options]');\n          productOptions.innerHTML = response.variant_options.join(', ');\n        }\n\n        /*\n          TODO: Bring in variant, and use that to check compare_at_price\n            to see if the item is on sale\n        */\n        const productPriceQuantity = flyOut.querySelector('[data-atc-banner-product-price-quantity]');\n        productPriceQuantity.innerHTML = `${quantity} × `;\n\n        $.ajax({\n          type: 'GET',\n          url: `${window.Theme.routes.cart_url}.js`,\n          dataType: 'json',\n        })\n          .done(secondResponse => {\n            if (this.settings.cartRedirection) {\n              location.href = window.Theme.routes.cart_url;\n              return;\n            }\n\n            this.callbacks.onSuccess();\n\n            // Reset formData in case instance is never cleared\n            this.formData = {};\n\n            let lineItem = null;\n            secondResponse.items.forEach(item => {\n              if (item.id === this.itemId) {\n                if (!lineItem) {\n                  lineItem = item;\n                } else {\n                  // If there are 2 lineItems with the same id, it means that there is\n                  // likely a BOGO offer on the product. We need to grab the highest discounted\n                  // price (BOGO will be 0) while also combining with the different discounts on\n                  // the product in the discounts array.\n                  lineItem.line_level_discount_allocations = lineItem\n                    .line_level_discount_allocations.concat(item.line_level_discount_allocations);\n                  lineItem.final_price = lineItem.final_price > item.final_price\n                    ? lineItem.final_price\n                    : item.final_price;\n                  lineItem.quantity += item.quantity;\n                }\n              }\n            });\n\n            const productPriceValue = flyOut.querySelector('[data-atc-banner-product-price-value]');\n            productPriceValue.innerHTML = Shopify.formatMoney(lineItem.original_price, this.settings.moneyFormat);\n\n            const productPriceDiscounted = flyOut.querySelector('[data-atc-banner-product-price-discounted]');\n            if (lineItem.final_price < lineItem.original_price) {\n              productPriceDiscounted.innerHTML = Shopify.formatMoney(lineItem.final_price, this.settings.moneyFormat);\n\n              productPriceDiscounted.classList.remove('hidden');\n              productPriceValue.classList.add('original-price');\n            } else {\n              productPriceDiscounted.classList.add('hidden');\n              productPriceValue.classList.remove('original-price');\n            }\n\n            const productDiscounts = flyOut.querySelector('[data-atc-banner-product-discounts]');\n\n            // Price Per Unit\n            const unitPrice = flyOut.querySelector('[data-atc-banner-unit-price]');\n            let unitPriceString = unitPrice.innerHTML;\n\n            if (unitPrice && lineItem.unit_price_measurement) {\n              unitPriceString = unitPriceString.replace(\n                '** total_quantity **',\n                `${lineItem.unit_price_measurement.quantity_value}${lineItem.unit_price_measurement.quantity_unit}`,\n              );\n\n              unitPriceString = unitPriceString.replace(\n                '** unit_price **',\n                Shopify.formatMoney(lineItem.unit_price, this.settings.money_format),\n              );\n              if (lineItem.unit_price_measurement.reference_value === 1) {\n                unitPriceString = unitPriceString.replace('** unit_measure **', lineItem.unit_price_measurement.reference_unit);\n              } else {\n                unitPriceString = unitPriceString.replace(\n                  '** unit_measure **',\n                  `${lineItem.unit_price_measurement.reference_value}${lineItem.unit_price_measurement.reference_unit}`,\n                );\n              }\n              unitPrice.innerHTML = unitPriceString;\n              unitPrice.classList.remove('hidden');\n            }\n\n            if (lineItem.line_level_discount_allocations.length > 0) {\n              const discountItemTemplate = productDiscounts.firstElementChild.cloneNode(true);\n              productDiscounts.innerHTML = '';\n\n              lineItem.line_level_discount_allocations.forEach(discount => {\n                const listItem = discountItemTemplate.cloneNode(true);\n                const title = listItem.querySelector('.discount-title');\n                const amount = listItem.querySelector('.discount-amount');\n\n                title.innerHTML = discount.discount_application.title;\n                amount.innerHTML = Shopify.formatMoney(discount.amount, this.settings.moneyFormat);\n                productDiscounts.appendChild(listItem);\n              });\n\n              productDiscounts.classList.remove('hidden');\n            } else {\n              productDiscounts.classList.add('hidden');\n            }\n\n            const subTotal = flyOut.querySelector('[data-atc-banner-cart-subtotal]');\n            subTotal.innerHTML = Shopify.formatMoney(secondResponse.total_price, this.settings.moneyFormat);\n\n            const itemCount = flyOut.querySelector('[data-atc-banner-cart-button] span');\n            itemCount.innerHTML = secondResponse.item_count;\n\n            this.header.appendChild(flyOut);\n\n            this.flyOut = flyOut;\n\n            setupRippleEffect(this.flyOut);\n\n            // Notifiy Header of new cart count\n            $(window).trigger('cartcount:update', { response: secondResponse });\n\n            /*\n            If user has initiated a new ATC Flow before the first has finished,\n            the first FlyOut could have opened after the first attempt to close open flyouts so\n            we need to send out an event to close any open flyouts.\n            */\n            document.dispatchEvent(new Event('closeFlyouts'));\n\n            const closeButton = flyOut.querySelector('[data-atc-banner-close]');\n\n            this.events.register(closeButton, 'click', e => this._closeFlyOut(e));\n            this.events.register(document, 'click', e => this._handleDocumentClick(e));\n            this.events.register(document, 'touchstart', e => this._handleDocumentClick(e));\n            this.events.register(document, 'closeFlyouts', e => this._closeFlyOut(e));\n            this.events.register(window, 'keydown', e => this._closeEsc(e));\n\n            this._enableAtcButton();\n\n            this.atcAnimation = transition({ el: this.flyOut, state: 'closed' });\n            this.atcAnimation.animateTo('open').then(() => {\n              trapFocus(this.flyOut);\n            });\n          });\n      })\n      .fail(response => {\n        let errorText;\n        try {\n          const responseText = JSON.parse(response.responseText);\n          errorText = responseText.description;\n        } catch (error) {\n          errorText = `${response.status} ${response.statusText}`;\n          if (response.status === 401) {\n            errorText = `${errorText}. Try refreshing and logging in.`;\n          }\n        }\n\n        this._enableAtcButton();\n        this.callbacks.onError(errorText);\n      });\n  }\n\n  _onError(error) {\n    this.messageBanner = new MessageBanner(error, 'error');\n  }\n\n  _onInit() {\n    if (this.messageBanner) {\n      this.messageBanner.unload();\n    }\n  }\n\n  _onSuccess() {\n    /*\n      By default, the ATC Flyout doesn't need any additional success callbacks\n\n      The `this.callbacks.onSuccess` is used to allow other views to initiate\n      behaviour when a product has been added to the cart\n     */\n  }\n\n  _onCloseAll() {\n    /*\n      By default, the ATC Flyout doesn't need any additional close callbacks\n\n      The `this.callbacks.onClose` is used to allow other views to initiate\n      behaviour when the atc banner has been closed\n     */\n  }\n\n  _closeEsc(e) {\n    if (e.key === 'Escape') {\n      this._closeFlyOut(e);\n    }\n  }\n\n  /**\n   * Close an open FlyOut\n   *\n   * @private\n   */\n  _closeFlyOut() {\n    if (!this.flyOut) {\n      return;\n    }\n\n    removeTrapFocus(this.flyOut);\n\n    // if the user clicked onto the search box, move focus\n    // to the search instead of going to the previous active element.\n    if (this.documentClickEventTarget && 'liveSearchInput' in this.documentClickEventTarget.dataset) {\n      this.documentClickEventTarget.focus();\n    } else if (this.activeElement) {\n      this.activeElement.focus();\n    }\n\n    this.atcAnimation.animateTo('closed').then(() => {\n      this.callbacks.onClose();\n      this.flyOut.remove();\n      this.flyOut = null;\n\n      this.events.unregisterAll();\n      this.atcAnimation.unload();\n      delete this.Images;\n    });\n  }\n\n  _disableAtcButton() {\n    this.atcButton.classList.add('processing');\n    this.atcButton.setAttribute('disabled', 'disabled');\n  }\n\n  _enableAtcButton() {\n    this.atcButton.removeAttribute('disabled');\n    this.atcButton.classList.remove('processing');\n  }\n\n  _handleDocumentClick(e) {\n    const { target } = e;\n    const $parent = $(target).parents('[data-atc-banner]');\n\n    if ($parent.length) {\n      return;\n    }\n\n    this.documentClickEventTarget = target;\n    this._closeFlyOut(e);\n  }\n}\n"],"sourceRoot":""}